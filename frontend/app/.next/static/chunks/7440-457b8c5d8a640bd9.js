"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7440],{12764:(e,a,r)=>{r.d(a,{A:()=>t});let t={LOGIN:"/auth/login",FORGOT_PASSWORD_SEND_OTP:"/auth/forgot-password/send-otp",VERIFY_OTP:"/auth/forgot-password/verify-otp",RESET_PASSWORD:"/auth/forgot-password/reset-password",GOOGLE_AUTH:"/auth/google",LOGOUT:"/auth/logout",REFRESH:"/auth/refresh"}},19072:(e,a,r)=>{r.d(a,{BD:()=>l,Ky:()=>i,ZO:()=>n,ri:()=>d,xw:()=>o});var t=r(12764),s=r(77567);let l=async e=>(await s.A.post(t.A.FORGOT_PASSWORD_SEND_OTP,{email:e})).data,n=async(e,a)=>(await s.A.post(t.A.VERIFY_OTP,{email:e,otp:a})).data,o=async(e,a,r)=>(await s.A.post(t.A.RESET_PASSWORD,{email:e,otp:a,newPassword:r})).data,i=async e=>(await s.A.post(t.A.GOOGLE_AUTH,{credential:e.credential})).data,d=async()=>{try{var e;let a=await s.A.post(t.A.LOGOUT,{});return localStorage.removeItem("authToken"),(null==(e=a.data)?void 0:e.success)||!1}catch(e){return localStorage.removeItem("authToken"),!1}}},30464:(e,a,r)=>{r.d(a,{VM:()=>d,iD:()=>i,LK:()=>o,xw:()=>u,uV:()=>c,$5:()=>l,Dl:()=>h,vJ:()=>n});let t={SIGNUP:"/auth/signup",VERIFY_OTP:"/auth/verify-otp",RESEND_OTP:"/auth/resend-otp",LOGIN:"/auth/login",PROFILE:"/users/profile",RESET_PASSWORD:"/users/reset-password",EMAIL_CHANGE_OTP_SEND:"/users/email/change",EMAIL_CHANGE_OTP_VERIFY:"/users/email/verify"};var s=r(77567);let l=async e=>(await s.A.post(t.SIGNUP,e)).data,n=async(e,a)=>(await s.A.post(t.VERIFY_OTP,{email:e,otp:a})).data,o=async e=>(await s.A.post(t.RESEND_OTP,{email:e})).data,i=async(e,a)=>(await s.A.post(t.LOGIN,{email:e,password:a})).data,d=async()=>(await s.A.get(t.PROFILE)).data,u=async(e,a)=>(await s.A.patch(t.RESET_PASSWORD,{newPassword:e,oldpassword:a})).data,c=async e=>(await s.A.post(t.EMAIL_CHANGE_OTP_SEND,{newEmail:e.newEmail,password:e.password})).data,h=async e=>(await s.A.post(t.EMAIL_CHANGE_OTP_VERIFY,{email:e.email,otp:e.otp})).data},33208:(e,a,r)=>{r.d(a,{Ay:()=>A,ET:()=>m,Lx:()=>i,RY:()=>o,p3:()=>d,y4:()=>c});var t=r(5710),s=r(30464),l=r(19072),n=r(59362);let o=(0,t.zD)("auth/verifyOtp",async(e,a)=>{let{email:r,otp:t}=e,{rejectWithValue:l}=a;try{let e=await (0,s.vJ)(r,t);if(e.success)return{user:e.data.user,role:e.data.role,redirectTo:e.data.redirectTo};return l(e.message)}catch(a){let e="OTP verification failed";if(a instanceof n.pe){var o,i,d,u,c;(null==(i=a.response)||null==(o=i.data)?void 0:o.message)?e=a.response.data.message:(null==(d=a.response)?void 0:d.status)===401?e="Invalid OTP":(null==(u=a.response)?void 0:u.status)&&(null==(c=a.response)?void 0:c.status)>=500?e="Server error. Please try again later.":a.request&&(e="Network error. Please check your connection.")}return l(e)}}),i=(0,t.zD)("auth/loginUser",async(e,a)=>{let{email:r,password:t}=e,{rejectWithValue:l}=a;try{let e=await (0,s.iD)(r,t);if(console.log("auth slice result is :",e),e.success)return{user:e.data.user,role:e.data.role,redirectTo:e.data.redirectTo};return l(e.message)}catch(a){let e="Login failed";if(a instanceof n.pe){var o,i,d,u,c;(null==(i=a.response)||null==(o=i.data)?void 0:o.message)?e=a.response.data.message:(null==(d=a.response)?void 0:d.status)===401?e="Invalid email or password":(null==(u=a.response)?void 0:u.status)&&(null==(c=a.response)?void 0:c.status)>=500?e="Server error. Please try again later.":a.request&&(e="Network error. Please check your connection.")}return l(e)}}),d=(0,t.zD)("auth/googleLogin",async(e,a)=>{let{rejectWithValue:r}=a;try{let a=await (0,l.Ky)(e);if(a.success)return{user:a.data.user,role:a.data.user.role||"user",isNewUser:a.data.isNewUser,redirectTo:a.data.redirectTo||"/dashboard"};return r(a.message||"Google authentication failed")}catch(e){if(e instanceof n.pe){var t,s,o,i;let a="Google Sign-In failed";return(null==(s=e.response)||null==(t=s.data)?void 0:t.message)?a=e.response.data.message:(null==(o=e.response)?void 0:o.status)&&(null==(i=e.response)?void 0:i.status)>=500?a="Server error. Please try again later.":e.request&&(a="Network error. Please check your connection."),r(a)}}}),u=(0,t.zD)("auth/checkStatus",async(e,a)=>{let{rejectWithValue:r}=a;try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let a=await e.json();return{user:a.data.user,role:a.data.user.role}}throw Error("Not authenticated")}catch(e){return r("Authentication check failed")}}),c=(0,t.zD)("auth/logout",async(e,a)=>{let{rejectWithValue:r}=a;try{return await (0,l.ri)(),null}catch(e){return null}}),h=(0,t.Z0)({name:"auth",initialState:{user:null,role:null,isAuthenticated:!1,loading:!1,error:null},reducers:{setUser:(e,a)=>{e.user=a.payload.user,e.role=a.payload.role,e.isAuthenticated=!0,e.error=null},clearUser:e=>{e.loading=!1,e.user=null,e.role=null,e.isAuthenticated=!1,e.error=null},setLoading:(e,a)=>{e.loading=a.payload},setError:(e,a)=>{e.error=a.payload},clearError:e=>{e.error=null},updateUser:(e,a)=>{e.user&&(e.user={...e.user,...a.payload})}},extraReducers:e=>{e.addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.role=a.payload.role,e.isAuthenticated=!0,e.error=null}).addCase(i.rejected,(e,a)=>{e.loading=!1,e.error=a.payload,e.isAuthenticated=!1}).addCase(d.pending,e=>{e.loading=!0,e.error=null}).addCase(d.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload&&a.payload.user,e.role=a.payload&&a.payload.role,e.isAuthenticated=!0,e.error=null}).addCase(d.rejected,(e,a)=>{e.loading=!1,e.error=a.payload,e.isAuthenticated=!1}).addCase(u.pending,e=>{e.loading=!0}).addCase(u.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.role=a.payload.role,e.isAuthenticated=!0,e.error=null}).addCase(u.rejected,e=>{e.loading=!1,e.user=null,e.role=null,e.isAuthenticated=!1,e.error=null}).addCase(c.fulfilled,e=>{e.loading=!1,e.user=null,e.role=null,e.isAuthenticated=!1,e.error=null}).addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.role=a.payload.role,e.isAuthenticated=!0,e.error=null}).addCase(o.rejected,(e,a)=>{e.loading=!1,e.error=a.payload,e.isAuthenticated=!1})}}),{setUser:p,clearUser:g,setLoading:y,setError:f,clearError:m,updateUser:w}=h.actions,A=h.reducer},47440:(e,a,r)=>{r.d(a,{A:()=>i});var t=r(95155),s=r(34540),l=r(33208),n=r(35695),o=r(12115);function i(e){let{children:a,allowedRoles:r,excludedRoles:i,allowUnauthenticated:d=!1,redirectOnAuth:u=!0}=e,{role:c,loading:h,isAuthenticated:p}=(()=>{let e=(0,s.wA)(),{user:a,role:r,isAuthenticated:t,loading:n}=(0,s.d4)(e=>e.auth);return{user:a,role:r,loading:n,isAuthenticated:t,logout:async()=>{await e((0,l.y4)()),localStorage.removeItem("role"),window.location.href="/login"}}})(),g=(0,n.useRouter)(),[y,f]=(0,o.useState)(!1);(0,o.useEffect)(()=>{f(!0)},[]),(0,o.useEffect)(()=>{if(!h&&u&&y){if(r&&r.length>0){if(!p&&!d)return void setTimeout(()=>{g.replace("/login")},1500);if(p&&c&&!r.includes(c)){let e=m(c);setTimeout(()=>{g.replace(e)},1500)}return}if(i&&i.length>0&&p&&c&&i.includes(c)){let e=m(c);setTimeout(()=>{g.replace(e)},1500);return}}},[h,p,c,g,i,r,d,u,y]);let m=e=>(()=>{switch(e){case"admin":return"/admin/dashboard";case"owner":return"/owner/dashboard";default:return"/"}})();if(!y)return null;if(h)return(0,t.jsx)("div",{className:"min-h-screen bg-[#040404] flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("p",{className:"text-gray-400",children:"Please wait..."})})});if(r&&r.length>0){if(!p&&!d||p&&c&&!r.includes(c))if(u)return(0,t.jsx)("div",{className:"min-h-screen bg-[#040404] flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("p",{className:"text-gray-400",children:"Taking you back..."})})});else return(0,t.jsx)("div",{className:"min-h-screen bg-[#040404] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-gray-400",children:"Access Denied"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"You don't have permission to view this page"}),p?(0,t.jsx)("button",{onClick:()=>g.replace(m(c)),className:"mt-4 bg-white text-black px-4 py-2 rounded hover:bg-gray-200",children:"Go to Dashboard"}):(0,t.jsx)("button",{onClick:()=>g.replace("/login"),className:"mt-4 bg-white text-black px-4 py-2 rounded hover:bg-gray-200",children:"Login"})]})});return(0,t.jsx)(t.Fragment,{children:a})}if(i&&i.length>0&&p&&c&&i.includes(c))if(u)return(0,t.jsx)("div",{className:"min-h-screen bg-[#040404] flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("p",{className:"text-gray-400",children:"Taking you back..."})})});else return(0,t.jsx)("div",{className:"min-h-screen bg-[#040404] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-gray-400",children:"Access Denied"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"You're already logged in"}),(0,t.jsx)("button",{onClick:()=>g.replace(m(c)),className:"mt-4 bg-white text-black px-4 py-2 rounded hover:bg-gray-200",children:"Go to Dashboard"})]})});return(0,t.jsx)(t.Fragment,{children:a})}},77567:(e,a,r)=>{r.d(a,{A:()=>d});var t=r(23464),s=r(12764);let l=t.A.create({baseURL:"https://cineora.fun/api",headers:{"Content-Type":"application/json"},withCredentials:!0}),n=!1,o=[],i=e=>{o.forEach(a=>{let{resolve:r,reject:t}=a;e?t(e):r()}),o=[],n=!1};l.interceptors.response.use(e=>e,async e=>{var a,r,t;let d=e.config;if(null==(a=d.url)?void 0:a.includes(s.A.REFRESH))return Promise.reject(e);if((null==(r=e.response)?void 0:r.status)===401&&!d._retry){if(n)return new Promise((e,a)=>{o.push({resolve:e,reject:a})}).then(()=>l(d)).catch(e=>Promise.reject(e));d._retry=!0,n=!0;try{return await l.post(s.A.REFRESH),i(null),l(d)}catch(e){return console.error(" Refresh failed:",e),i(e),window.location.href="/login",Promise.reject(e)}}return(null==(t=e.response)?void 0:t.status)===401&&(window.location.href="/login"),Promise.reject(e)});let d=l}}]);